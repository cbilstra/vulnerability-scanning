import re
import datetime
from DMDP import calculate

# CVE-2011-2262 https://www.cvedetails.com/cve/CVE-2011-2262/
patch_date_2262 = datetime.datetime.strptime("2012-01-18", '%Y-%m-%d')
search_banner = ""


def mdp_2262():
    calculate(patch_date_2262, get_version_number, is_vulnerable_2262, search_banner, mysql=True)


def is_vulnerable_2262(version: str):
    splitted = version.split(".")
    if len(splitted) < 3:
        return False  # cannot determine

    try:
        minor = int(splitted[2])
    except ValueError:
        return False

    if version.startswith("5.1."):
        return minor <= 50
    elif version.startswith("5.5."):
        return minor <= 28
    else:
        return False


def get_version_number(input_banner: str):
    matches = re.findall("[0-9]+\.[0-9]+\.[0-9]+-[0-9A-Za-z]*", input_banner)
    if len(matches) > 0:
        return matches[0].split("-")[0]
    return None


if __name__ == '__main__':
    mdp_2262()
