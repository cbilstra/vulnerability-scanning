import re
import datetime
from DMDP import calculate

banner = 'SSH Tectia'
# https://web.archive.org/web/20121211052050/www.ssh.com/index.php/component/content/article/531.html
patch_date = datetime.datetime.strptime("2012-12-05", '%Y-%m-%d') # Patched on 2012-12-05, CVE published on 2012-12-03,
search_pattern = re.compile(r'\-(?P<version>\d\.\d\.\d*).+SSH Tectia')


def mdp():
    calculate(patch_date, get_version_number, is_vulnerable, banner, ssh=True)


def get_version_number(input_banner: str):
    matches = search_pattern.search(input_banner)

    if matches is None:
        return None
    return matches.group('version')


def is_vulnerable(input_version) -> bool:
    ver = [int(x) for x in input_version.split('.')]
    
    if ver[0] == 6:
        if ver[1] == 0:
            return 4 <= ver[2] <= 20
        
        if ver[1] == 1:
            return 0 <= ver[2] <= 12

        if ver[1] == 2:
            return 0 <= ver[2] <= 5

        if ver[1] == 3:
            return 0 <= ver[2] <= 2

    return False


if __name__ == '__main__':
    mdp()
