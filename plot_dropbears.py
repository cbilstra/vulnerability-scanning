import numpy as np

arrays = np.load('processed_data/critical_201209_22.npz', allow_pickle=True)
entries = arrays['arr_0']


def get_version_number(input_banner: str):
    dropbear_tag = input_banner[input_banner.find('SSH-2.0-dropbear'):]
    return dropbear_tag.split("\r")[0].split("_")[1]


def is_vulnerable(input_version) -> bool:
    ver = int(input_version.split(".")[1][:2])
    if 52 <= ver <= 54:
        return True

    return False


# Extract dropbear services and version
dropbear_scans = []
for banner in entries['banner']:
    if 'SSH-2.0-dropbear' in banner:
        print(banner)
        dropbear_scans.append((version := get_version_number(banner), is_vulnerable(version)))
    else:
        dropbear_scans.append(None)


print(dropbear_scans[:250])
